# docker-compose.yaml
version: "3.8" # Phiên bản Docker Compose

services:
   # Dịch vụ PostgreSQL cho User Service
   user_db:
      image: postgres:16-alpine # Sử dụng image PostgreSQL phiên bản 16 (phiên bản alpine nhỏ gọn)
      container_name: ecommerce_user_db # Tên container
      environment: # Các biến môi trường để cấu hình PostgreSQL
         POSTGRES_DB: user_service_db # Tên cơ sở dữ liệu
         POSTGRES_USER: user # Tên người dùng
         POSTGRES_PASSWORD: password # Mật khẩu
      ports:
         - "5432:5432" # Ánh xạ cổng 5432 của container ra cổng 5432 của host
      volumes:
         - user_db_data:/var/lib/postgresql/data # Lưu trữ dữ liệu vào volume để dữ liệu không bị mất khi container dừng
      healthcheck: # Kiểm tra sức khỏe của DB
         test: ["CMD-SHELL", "pg_isready -U user -d user_service_db"]
         interval: 5s
         timeout: 5s
         retries: 5
      restart: always # Luôn khởi động lại container nếu có sự cố

volumes:
   user_db_data: # Định nghĩa volume để lưu trữ dữ liệu bền vững
